---
import { getCollection } from 'astro:content';

interface Props {
  novelId: string;
}

const { novelId } = Astro.props;

const chapters = await getCollection('blog', ({ data }) => {
  return data.novel === novelId && !data.draft;
});

// Sort by chapter_number
const sortedChapters = chapters.sort((a, b) => {
  const aNum = a.data.chapter_number ?? 0;
  const bNum = b.data.chapter_number ?? 0;
  return aNum - bNum;
});

// Group by section if needed, but for now a clean list
---

<div class="novel-collection mt-12 border-t pt-8">
  <h2 class="text-2xl font-semibold mb-6">Table of Contents</h2>
  <nav class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {sortedChapters.map((chapter) => (
      <a 
        href={`/blog/${chapter.id}`}
        class="flex items-center p-3 rounded-lg border bg-card hover:bg-accent transition-colors group"
      >
        <div class="flex-1">
          <div class="text-sm text-muted-foreground">Chapter {chapter.data.chapter_number}</div>
          <div class="font-medium group-hover:text-accent-foreground">{chapter.data.title.replace(/.*: /, '')}</div>
        </div>
        <div class="text-muted-foreground group-hover:text-accent-foreground">
           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"/></svg>
        </div>
      </a>
    ))}
  </nav>
</div>
